box: golang
build:
  steps:
    - wercker/setup-go-workspace:
        package-dir: github.com/alexkappa/crond

    - script:
        name: test
        code: |
          go test

    - script:
        name: build
        code: |
          make OS=linux ARCH=amd64

    - script:
        name: copy binaries
        code: |
          cp bin/* $WERCKER_OUTPUT_DIR
release:
  steps:
    - script:
        name: get version
        code: |
          export VERSION=$(/usr/bin/crond -v)

    - wercker/github-upload-asset@1.0.1:
        token: $GITHUB_TOKEN
        file: crond-darwin-amd64

    - wercker/github-upload-asset@1.0.1:
        token: $GITHUB_TOKEN
        file: crond-linux-amd64

    - wercker/github-create-release@1.0.1:
        token: $GITHUB_TOKEN
        tag: $VERSION
