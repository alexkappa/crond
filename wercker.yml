box: golang
build:
  steps:
    - wercker/setup-go-workspace:
        package-dir: github.com/alexkappa/crond

    - script:
        name: test
        code: |
          go test

    - script:
        name: build
        code: |
          make OS=linux ARCH=amd64

    - script:
        name: copy binaries
        code: |
          cp bin/crond-linux-amd64 $WERCKER_OUTPUT_DIR/crond
release:
  box: yieldr/debian
  steps:
    - script:
        name: copy binaries
        code: |
          cp $WERCKER_SOURCE_DIR/* /usr/bin

    - script:
        name: get version
        code: |
          export VERSION=$(/usr/bin/crond -v)

    - internal/docker-push:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        repository: alexkappa/crond
        tag: $VERSION
        cmd: crond /etc/cron.d

    - wercker/github-create-release@1.0.1:
        token: $GITHUB_TOKEN
        tag: $VERSION
        body: |
          You can find the latest release at [hub.docker.com](https://hub.docker.com/r/alexkappa/crond/tags/).

          ```
          docker pull alexkappa/crond:$VERSION
          ```
